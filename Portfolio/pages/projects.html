// filepath: d:\Codes and programs\GitHub-repos\Portfolio\Scripts\downloading.js
class DownloadManager {
  constructor() {
    this.isDownloading = false;
    this.overlay = null;
    this.progressBar = null;
    this.progressText = null;
    this.syncIcon = null;
    this.contentDiv = null;

    this.init();
    this.showInitialProgress(); // Show the overlay on page load
  }

  init() {
    this.createProgressOverlay();
    this.bindDownloadButtons();
    this.bindKeyboardEvents();
  }

  createProgressOverlay() {
    // Create overlay element
    this.overlay = document.createElement("div");
    this.overlay.className = "download-progress-overlay";
    this.overlay.setAttribute("role", "dialog");
    this.overlay.setAttribute("aria-labelledby", "download-title");
    this.overlay.setAttribute("aria-describedby", "download-description");

    // Create content container
    this.contentDiv = document.createElement("div");
    this.contentDiv.className = "download-progress-content";

    // Create content HTML with "Hi" message and security icons
    this.contentDiv.innerHTML = `
            <div class="greeting-container">
                <div class="greeting-icon">
                    <i class="fas fa-shield-alt"></i>
                    <i class="fas fa-biohazard"></i>
                </div>
                <h3 id="download-title">Hi there! <span class="wave">ðŸ‘‹</span></h3>
                <p id="download-description">Securely downloading your CV...</p>
            </div>
            <div class="sync-icon">
                <i class="fas fa-sync-alt"></i>
            </div>
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
            <div class="progress-text">Initializing secure connection...</div>
            <button class="close-progress" style="display: none;">Close</button>
        `;

    this.overlay.appendChild(this.contentDiv);
    document.body.appendChild(this.overlay);

    // Get references to elements
    this.progressBar = this.overlay.querySelector(".progress-bar");
    this.progressText = this.overlay.querySelector(".progress-text");
    this.syncIcon = this.overlay.querySelector(".sync-icon i");
    this.greetingContainer = this.overlay.querySelector(".greeting-container");

    // Bind close button
    const closeBtn = this.overlay.querySelector(".close-progress");
    closeBtn.addEventListener("click", () => this.hideProgress());

    // Close on overlay click
    this.overlay.addEventListener("click", (e) => {
      if (e.target === this.overlay) {
        this.hideProgress();
      }
    });
  }

  showInitialProgress() {
    this.showProgress();
    this.simulateDownloadProgress().then(() => {
      this.hideProgress();
    });
  }

  async startDownload(url, filename, buttonElement) {
    if (this.isDownloading) return;

    this.isDownloading = true;

    // Add downloading state to button
    if (buttonElement) {
      buttonElement.classList.add("downloading");
      const icon = buttonElement.querySelector("i");
      if (icon) {
        icon.className = "fas fa-sync-alt";
      }
    }

    // Show progress overlay
    this.showProgress();

    try {
      // Simulate download progress steps
      await this.simulateDownloadProgress();

      // Actually start the download
      await this.downloadFile(url, filename);

      // Show success state
      this.showSuccess();

      // Show success notification
      this.showNotification(
        "Download Complete",
        "Your CV has been downloaded successfully!",
        "success"
      );
    } catch (error) {
      console.error("Download failed:", error);
      this.showError("Download failed. Please try again.");
      this.showNotification(
        "Download Failed",
        "There was an error downloading your CV.",
        "error"
      );
    } finally {
      // Reset button state
      if (buttonElement) {
        buttonElement.classList.remove("downloading");
        const icon = buttonElement.querySelector("i");
        if (icon) {
          icon.className = "fas fa-download";
        }
      }

      this.isDownloading = false;

      // Auto-hide after success/error
      setTimeout(() => {
        this.hideProgress();
      }, 3000);
    }
  }

  // ... (rest of the existing methods remain unchanged)
}

// Initialize download manager when DOM is loaded
document.addEventListener("DOMContentLoaded", () => {
  new DownloadManager();
});